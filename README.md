# dbt Timeline Visualization

A comprehensive dbt model lineage timeline visualization inspired by Airbnb's data timeliness tracker. Features project and date filters, full-page horizontal layout, model execution nodes with dependency connections, and execution time-based color coding.

The app relies on the dbt package [dbt-artifacts](https://hub.getdbt.com/brooklyn-data/dbt_artifacts/latest/) and expects its output (specifically the tables `dim_dbt__models` and `fct_dbt__model_executions`) to be available in the chosen schema.

Created with Replit.

## Features

- **Timeline Visualization**: Horizontal timeline showing dbt model execution flow
- **Color-coded Performance**: Green (<5min), Yellow (5-15min), Red (>15min) execution times (can be changed via `backend/database.py`)
- **Interactive Navigation**: Dual-handle time range slider for timeline exploration
- **Dark Mode Support**: Toggle between light and dark themes
- **Project and Date Filtering**: Select different dbt projects and execution dates
- **Database Connection**: Connects to PostgreSQL database with actual dbt execution data. Other databases can be quickly supported.

## Architecture

- **Backend**: Python FastAPI server (port 5000)
- **Frontend**: React TypeScript with Vite (port 80)
- **Database**: PostgreSQL with configurable schema support
- **Configuration**: YAML-based database configuration

## Quick Setup

### 1. Prerequisites
```bash
# Ensure you have Node.js, Python 3.11+, and PostgreSQL available
```

### 2. Install Dependencies
```bash
# Install root dependencies
npm install

# Install frontend dependencies  
cd frontend && npm install && cd ..

# Install backend dependencies
cd backend && pip install -r requirements.txt && cd ..
```

### 3. Database Configuration

Edit `backend/config.yaml` to configure your database:

```yaml
database:
  url: ${DATABASE_URL}  # Uses environment variable
  schema: public        # Change to your schema containing the output of dbt-artifacts package (e.g., analytics, dbt_warehouse)
```

### 4. Database Schema

Your PostgreSQL database should contain these tables in the specified schema:

- Projects table (contains a list of your dbt projects): 
```sql
-- Projects table
CREATE TABLE {schema}.dbt_projects (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```
- Models dimension table: Generated by dbt-artifacts package. For multiple projects, you can use `UNION` and create one table with the output of the different projects.

- Model executions fact table: Generated by dbt-artifacts package. For multiple projects, you can use `UNION` and create one table with the output of the different projects.

### 5. Run Application
```bash
# Start both servers
python dev.py

# Or start manually:
# Backend: cd backend && python main.py
# Frontend: cd frontend && npm run dev
```

## Development

### Configuration Management

The application uses YAML configuration for database settings:

- **File**: `backend/config.yaml`
- **Environment Variables**: Supports `${VARIABLE_NAME}` substitution
- **Schema Configuration**: Easily switch between database schemas

### Project Structure
```
dbt-timeline-visualization/
├── backend/                 # Python FastAPI backend
│   ├── config.yaml         # Database configuration
│   ├── config_loader.py    # Configuration management
│   ├── database.py         # Database service layer
│   ├── main.py            # FastAPI application
│   ├── models.py          # Pydantic data models
│   └── requirements.txt   # Python dependencies
├── frontend/               # React TypeScript frontend
│   ├── components/        # React components
│   ├── lib/              # Utility functions
│   ├── Timeline.tsx      # Main timeline component
│   └── App.tsx           # Application entry point
├── dev.py                # Development server runner
└── README.md            # This file
```

### Available Scripts

```bash
# Start development servers (both backend and frontend)
python dev.py

# Backend only
cd backend && python main.py

# Frontend only
cd frontend && npm run dev

# Build for production
cd frontend && npm run build
```

## API Endpoints

- `GET /api/projects` - List all dbt projects
- `GET /api/timeline/{project_id}/{date}` - Get timeline data for specific project and date
- `GET /` - API status and available endpoints

## Database Configuration

The application reads database configuration from `backend/config.yaml`:

```yaml
database:
  url: ${DATABASE_URL}     # Environment variable substitution
  schema: your_schema      # Configurable schema name
```

## License

MIT License - see LICENSE file for details.
